# アーキテクチャ

このプロジェクトは、主にC++で記述された複数のDLLプロジェクトで構成されています。

## 主要コンポーネント

-   **Plugin/**: EU4の32bit版に対応するメインのプラグインプロジェクトです。文字描画や入力処理など、ゲームの様々な機能にフックをかけて改造します。
-   **Plugin64/**: EU4の64bit版に対応するメインのプラグインプロジェクトです。`Plugin/` と同様の機能を持ちますが、64bitアーキテクチャ用にビルドされます。
-   **d3d9/**: Direct3D 9 のプロキシDLLとして動作し、ゲームの描画処理に介入します。主にフォントのレンダリングを担当します。
-   **version/**: `version.dll` のプロキシDLLとして動作し、DLLインジェクションの起点となります。
-   **source/**: D言語で書かれたソースコードが含まれています。
-   **resource/**: リリース用のDLLや設定ファイルが配置されます。
-   **memory-bank/**: AIアシスタントがプロジェクトを理解するためのドキュメントが格納されています。
-   **.clinerules**: AIアシスタントの動作を定義するルールファイルです。

## データフロー

1.  ゲーム（`eu4.exe`）が起動すると、WindowsのDLL読み込み機構により、プロキシDLLである `version.dll`（`version/` プロジェクト）が読み込まれます。
2.  `version.dll` は、`d3d9.dll`（`d3d9/` プロジェクト）と、メインのプラグインDLL（`Plugin.dll` または `Plugin64.dll`）をロードします。
3.  `d3d9.dll` は、ゲームのDirect3Dデバイスをフックし、テキスト描画処理を乗っ取ります。これにより、カスタムフォントの利用や2バイト文字の描画が可能になります。
4.  メインのプラグインDLLは、ゲーム内の様々な関数をフックし、UIの調整、入力処理の改善、その他の拡張機能を提供します。
