# D言語移行 TODOリスト

## 優先度: 高

-   [x] `Plugin64/` ディレクトリ内の残りのC++ファイルをD言語に移植する。
    -   **入力・IME関連モジュール**
        -   `input.cpp` / `input_asm.asm`: テキスト入力フック、UTF-8変換。
        -   `ime.cpp` / `ime_asm.asm`: IME制御、再変換対応など。
    -   **フォント・テキスト描画・整形モジュール**
        -   `font.cpp` / `font_asm.asm`: フォントバッファ管理、サイズ拡張。
        -   `main_text.cpp` / `main_text_asm.asm`: メインテキスト描画フック。
        -   `list_field_adjustment.cpp` / `list_field_adjustment_asm.asm`: リストビューの文字調整。
        -   `date.cpp` / `date_asm.asm`: 日付フォーマット修正。
        -   `localization.cpp` / `localization_asm.asm`: ローカライズ関連（人名順序など）。
    -   **マップ・UI表示調整モジュール**
        -   `map_view.cpp` / `map_view_asm.asm`: マップ上のテキスト表示。
        -   `map_adjustment.cpp` / `map_adjustment_asm.asm`: マップ文字位置調整。
        -   `map_justify.cpp` / `map_justify_asm.asm`: マップ文字均等割付。
        -   [ ] `map_popup.cpp` / `map_popup_asm.asm`: ポップアップ表示調整。
        -   [ ] `tooltip_and_button.cpp` / `tooltip_and_button_asm.asm`: ツールチップとボタンのUI調整。
        -   [ ] `event_dialog.cpp` / `event_dialog_asm.asm`: イベントダイアログ修正。
    -   **システム・その他機能モジュール**
        -   [ ] `file_save.cpp` / `file_save_asm.asm`: セーブデータ関連。
        -   [ ] `options.cpp`: 設定ファイル (`plugin.ini`) 読み込み。
        -   [ ] `dll_main.cpp`, `version.cpp`: DLLエントリーポイント、バージョン管理。
-   [ ] Linux環境でのパッチ適用方法を `LD_PRELOAD` を利用した手法に移行する。
    -   `d3d9.dll` プロキシの代わりに、共有オブジェクト（`.so`）を `LD_PRELOAD` でロードする仕組みを実装する。
    -   Windows API (`VirtualProtect` など) に依存しているコードをLinux API (`mprotect(2)`, `dl_iterate_phdr(3)` など) を使用するように書き換える。
    -   パッチ実行の起点として `__attribute__((constructor))` を利用する。
    -   `version/` プロジェクトの機能（DLLインジェクションの起点）を `LD_PRELOAD` 方式に適合させる。
-   [ ] Linux環境での動作検証とデバッグ。
    -   `mprotect(2)` を利用したメモリパッチの安定性確認。
-   [ ] **翻訳ファイルダウンローダーのPoC作成**
    -   `tests/poc/downloader.d` の作成。
    -   `std.net.curl` を使用したファイルのダウンロード機能の実装。
    -   OSごとの適切な保存先パス（Linux: `~/.local/share/...`, Windows: `Documents/...`）の解決ロジック実装。
    -   既存の `mod_download.cpp` / `claes.exe` 依存からの脱却準備。

## 優先度: 中

-   [ ] 移植されたD言語コードのパフォーマンス最適化。
-   [ ] D言語のユニットテストカバレッジの拡充。
-   [ ] CI/CDパイプラインのD言語ビルドプロセスへの適応。

## 優先度: 低

-   [ ] ドキュメントのD言語移行に関する詳細な記述の追加。
-   [ ] D言語のコーディング規約の策定と適用。
